<view class="container">
  <!-- 自定义导航栏 -->
  <view class="custom-nav">
    <view class="nav-content">
      <view class="back-icon-nav">
         <image 
            class="back-icon" 
            src="https://miniknowledge.9000aigc.com/assets/icons/back (1).png" 
            mode="aspectFit"
            bindtap="navigateBack"
        />
      </view>
      <view class="nav-title">课程</view>
    </view>
  </view>
  
  <!-- 视频播放区域 -->
  <view class="video-container">
    <!-- 有视频链接时显示视频播放器 -->
    <block wx:if="{{currentLesson.videoUrl}}">
      <video 
        id="lessonVideo"
        class="video-player"
        src="{{currentLesson.videoUrl}}"
        poster="{{currentLesson.coverImage}}"
        title="{{currentLesson.title}}"
        play-btn-position="center"
        enable-play-gesture="{{true}}"
        show-screen-lock-button="{{true}}"
        show-snapshot-button="{{false}}"
        show-progress="{{true}}"
        bindplay="onVideoPlay"
        bindpause="onVideoPause"
        bindended="onVideoEnd"
        binderror="onVideoError"
      />
    </block>

    <!-- 没有视频链接时显示封面图 -->
    <block wx:else>
      <image 
        class="video-cover"
        src="{{currentLesson.coverImage}}"
        mode="aspectFill"
      />
      <view class="video-lock-mask">
        <image class="lock-icon" src="/assets/icons/lock.png" />
        <!-- 根据错误类型显示不同提示 -->
        <block wx:if="{{errorType === 'no_access'}}">
          <text class="lock-text">报名后即可收看</text>
          <button class="unlock-btn" bindtap="goBuyCourse">立即报名</button>
        </block>
        <block wx:else>
          <text class="lock-text">开通会员观看完整视频</text>
          <button class="unlock-btn" bindtap="goToVip">立即开通</button>
        </block>
      </view>
    </block>
    
    <!-- 倍速控制按钮 -->
    <view class="rate-control">
      <view class="rate-btn" bindtap="toggleRateList">
        {{currentRate}}x
      </view>
      <!-- 倍速选择列表 -->
      <view class="rate-list {{showRateList ? 'show' : ''}}" wx:if="{{showRateList}}">
        <view 
          class="rate-item {{currentRate === rate ? 'active' : ''}}" 
          wx:for="{{playbackRates}}" 
          wx:key="*this" 
          wx:for-item="rate"
          data-rate="{{rate}}"
          bindtap="changePlaybackRate"
        >
          {{rate}}x
        </view>
      </view>
    </view>
  </view>
  
  <!-- 课时信息 -->
  <view class="lesson-info">
    <view class="lesson-title">{{lessonTitle}}</view>
    <view class="lesson-teacher">讲师：{{teacherInfo}}</view>
  </view>
  
  <!-- 相关推荐 -->
  <view class="related-lessons">
    <view class="section-title">
      <view class="title-bar"></view>
      <text>章节列表</text>
    </view>
    
    <scroll-view class="chapter-scroll" scroll-x="true" enable-flex="true">
      <view class="chapter-list">
        <view class="chapter-item" 
              wx:for="{{chapterList}}" 
              wx:key="id"
              bindtap="playChapter"
              data-id="{{item.id}}"
              data-title="{{item.title}}"
              data-url="{{item.videoUrl || item.coverImage}}">
          <view class="chapter-cover-container">
            <image class="chapter-cover" src="{{item.coverImage}}" mode="aspectFill"></image>
            <view class="chapter-duration">{{item.duration}}分钟</view>
          </view>
          <view class="chapter-title">{{item.title}}</view>
        </view>
      </view>
    </scroll-view>
  </view>
</view> 